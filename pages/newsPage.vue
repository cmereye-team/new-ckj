<script lang="ts" setup>
import { setTimeout } from "timers/promises"

useHead({
  title: "ÊúÄÊñ∞Ê∂àÊÅØ"
})
const activeIndex = 0
const handleNewsItem = (_idx:number) =>{
  newsLists.value[_idx].isShow = true
}
let newsLists = ref([{
  id: '',
  imgUrl: '',
  title: '',
  context: '',
  link: '',
  month: '',
  day: '',
  isShow: false,
  type: ''
}])
const localLists = ref([
  {
    id: '19',
    imgUrl: 'https://static.cmereye.com/imgs/2023/06/ea16bdef65414cbc.jpg',
    title: '„ÄêÊàëÈÅ©ÂêàÊ§çÁâôÂóéÔºü„Äë',
    context: 'ÈõñÁÑ∂Ê§çÁâôÊúâÂ•ΩÂ§öÂ•ΩËôïÔºå‰∏çÈÅéÂîî‰øÇ‰∫∫‰∫∫ÈÉΩÈÅ©ÂêàÂÅöÊ§çÁâô„óéÔºÅÊ§çÁâôÂêåÂÖ∂‰ªñÁâôÁßëÊ≤ªÁôÇ‰∏ÄÊ®£ÔºåÂ¶ÇÊûúÊú¨Ë∫´ÊÇ£ÊúâÊú™ÂèóËó•Áâ©ÊéßÂà∂ÁöÑÂøÉË°ÄÁÆ°ÁñæÁóÖ„ÄÅÂÖçÁñ´Á≥ªÁµ±ÁñæÁóÖÁ≠âÁ≠âÔºåÂ∞±ÈúÄË¶ÅÁâπÂà•‰ΩúÂ∞èÂøÉË©ï‰º∞ÊàñËÄÖË™øÊï¥Ê≤ªÁôÇÊôÇÈñì„ÄÇ',
    link: '/service/dentalImplant',
    month: 'JAN',
    day: '16',
    type: 'Á®ÆÊ§çÁâô',
    isShow: false
  },
  {
    id: '20',
    imgUrl: 'https://static.cmereye.com/imgs/2023/06/3bfef0469a952097.jpg',
    title: '„ÄêÊùúÁâôÊ†πÂæåÂ∞±ÂîîÊúÉÂÜçËõÄÁâôÔºü„Äë',
    context: '‰ª•ÁÇ∫ÂÅöÂÆåÊùúÁâôÊ†πÊïëËøîÈöªÂö¥ÈáçËõÄÁâôÔºåÂä†ÂüãÂÄãÁâôÂ•óÂåÖ‰ΩèÔºåÈöªÁâôÂ∞±ÁôæÊØí‰∏ç‰æµÔºåÂîîÊúÉÂÜçËõÄÂ§öÊ¨°ÔºüÂ∞çÊùúÁâôÊ†πÁôÇÁ®ãÊúâÁñëÂïèÔºåÂø´Âï≤ÂéªË´ÆË©¢ÁâôÁßëÈÜ´ÁîüÂï¶ÔºÅ',
    link: '/dental-service/rootCanal',
    month: 'JAN',
    day: '15',
    type: 'Ê†πÁÆ°Ê≤ªÁôÇ',
    isShow: false
  },
  {
    id: '21',
    imgUrl: 'https://static.cmereye.com/imgs/2023/06/c83f7c9432a168d3.jpg',
    title: '„Äê„ÄåÊùúÁâôÊ†π„Äç‰øÇÂí©ÂöüÔºü„Äë',
    context: 'ÊùúÁâôÊ†π‰øÇÂ∞àÁÇ∫ËõÄÁâôÈÄ≤Ë°å‰øÆË£úÂòÖÊâãË°ìÔºåÁõÆÁöÑ‰øÇÂ∞áÂèóÊÑüÊüì/Â£ûÊ≠ªÂòÖÁâôÈ´ìÁµÑÁπîÊ∏ÖÈô§„ÄÇÁî±ÊñºÊ†πÁÆ°Ê≤ªÁôÇËºÉË§áÈõúÔºåÂª∫Ë≠∞Â¶ÇÊÇ£‰∏äËõÄÁâôÂïèÈ°å‰æøÁ´ãÂç≥Â∞±ÈÜ´ÔºåÂîîÂ•ΩÂª∂Ë™§Ê≤ªÁôÇÊôÇÈñìÂë¢~',
    link: '/dental-service/rootCanal',
    month: 'JAN',
    day: '14',
    type: 'Ê†πÁÆ°Ê≤ªÁôÇ',
    isShow: false
  },
  {
    id: '22',
    imgUrl: 'https://static.cmereye.com/imgs/2023/06/ff117a08ad3d03cb.jpg',
    title: '„ÄêCKJÊÑõÂ∫∑ÂÅ• Ê≠£ÂºèÂä†ÂÖ•FB+IGÂπ≥Âè∞„Äë',
    context: '‰∏≠ÂøÉ‰ΩçÊñºÊ∑±Âú≥Â∏ÇÁæÖÊπñÂçÄÔºåÁõÆÂâçÂ∑≤Êúâ13ÈñìÈñÄË®∫ÔºåÊèê‰æõË∂ÖÈÅé20Á®ÆÁâôÁßëÊúçÂãôÔºåÂåÖÊã¨ÔºöÊ¥óÁâôÔºåË£úÁâôÔºåÁâôÈΩíÁæéÁôΩÔºåÁÆçÁâôÔºåÊ§çÁâôÔºåÈö±ÂΩ¢ÁâôÁÆçÔºåÊô∫ÊÖßÈΩíÊâãË°ìÔºå3DÈõªËÖ¶ÊéÉÊèèÊ™¢Êü•Á≠âüôå',
    link: '',
    month: 'JUN',
    day: '13',
    type: 'ÂÖ∂‰ªñ',
    isShow: false
  }
])
let saveLists = ref([
  ...localLists.value
])
const getNewsLists = async () => {
  const { data } = await useFetch('https://admin.ckjhk.com/api.php/list/2/page/1',{
    method: 'post',
    onResponse({ request, response, options }) {
      // console.log('Ë´ãÊ±ÇÁµêÊûúÔºöresponse',JSON.parse(response._data))
      let res = JSON.parse(response._data) || null
      if(res){
        if(res.data && res.data.length){
          let ids = localLists.value.map(item=> item.id)
          let _newsLists = res.data.filter(item=> !ids.includes(item.id))
          let _saveLists = _newsLists.map(item=>{
            let _date = new Date(item.ext_news_date)
            return {
              id: item.id,
              title: item.title || '',
              imgUrl: item.pics && `https://admin.ckjhk.com${item.pics}`,
              link: item.ext_banner_link || '',
              context: item.ext_news_context || '',
              month: _date.toDateString().split(" ")[1].toUpperCase() || '',
              day: _date.toDateString().split(" ")[2] || '',
              isShow: false,
              type: item.ext_news_type
            }
          })
          saveLists.value = [
            ..._saveLists,
            ...localLists.value
          ]
          // console.log('saveLists: ---------------------->',saveLists.value)
        }
      }
    }
  });
  filterLists()
}

getNewsLists()

let dateCur = ref('0')
let typeCur = ref('ÊâÄÊúâÈ°ûÂà•')
const filterLists = () => {
  // console.log('saveLists: ---------------------->',saveLists.value)
  newsLists.value = saveLists.value.filter(item=>{
    if(dateCur.value === '0' && (typeCur.value === 'ÊâÄÊúâÈ°ûÂà•' || typeCur.value === 'ÊâÄÊúâÁ±ªÂà´')){
      // console.log('ÊâÄÊúâÊúà‰ªΩ„ÄÅÊâÄÊúâÁ±ªÂûã')
      return item
    }else{
      // console.log('ÈùûÊâÄÊúâÊúà‰ªΩ„ÄÅÈùûÊâÄÊúâÁ±ªÂûã')
      if(dateCur.value === '0'){
        // console.log(item)
        if( item.type && item.type.indexOf(typeCur.value) !== -1){
          // console.log('ÊåáÂÆöÁ±ªÂûãÔºö',typeCur.value)
          return item
        }
      }else if(typeCur.value === 'ÊâÄÊúâÈ°ûÂà•' || typeCur.value === 'ÊâÄÊúâÁ±ªÂà´'){
        if(item.month === dateCur.value){
          // console.log('ÊåáÂÆöÊúà‰ªΩÔºö',dateCur.value)
          return item
        }
      }else{
        if(item.month === dateCur.value && (item.type &&  item.type.indexOf(typeCur.value) !== -1 )){
          // console.log('ÊåáÂÆöÊúà‰ªΩ„ÄÅÊåáÂÆöÁ±ªÂûãÔºö',dateCur.value)
          return item
        }
      }
    }
  })
  // console.log(newsLists.value)
}

const changeMonthCur = (_data:any) =>{
  dateCur.value = _data.date
  typeCur.value = _data.type
  filterLists()
}

let windowWidth = ref(1920)

onMounted(()=>{
  getWindowWidth()
  window.addEventListener('resize',getWindowWidth)
})

const getWindowWidth = () => {
  windowWidth.value = window.innerWidth
  // console.log(windowWidth)
}

</script>

<template>
  <div>
  <!-- <div class="bigPageCon"> -->
    
      <!-- :headerBg="'https://static.cmereye.com/imgs/2023/04/fbca451e1a8a9ba4.jpg'"
      :headerImg="'https://static.cmereye.com/imgs/2023/05/c46fcc590da0ffdd.png'"
      :headerBgImg="'https://static.cmereye.com/imgs/2023/05/de7105389a7f04b2.png'"
      :mbBg="'https://static.cmereye.com/imgs/2023/04/65b135487a85f4f0.jpg'"
      :titlePosition="'left'" -->
    <PageHeader /> 
    <div class="newsPage">
      <LatestNews />
      <div class="newsBox pageCon">
        <div class="newsBox-title">
          <div class="index_title">ÊúÄÊñ∞Ê∂àÊÅØ</div>
          <div>
           <dropdownCon @changeCur="changeMonthCur" />
          </div>
        </div>
        <div class="newsBox-in">
          <div class="newsItem" v-for="(newItem,newIndex) in newsLists" :key="newIndex" @click="handleNewsItem(newIndex)">
            <div class="newsItem-in">
              <div class="newsItem-in-l">
                <img :src="newItem.imgUrl" alt="" />
              </div>
              <div class="newsItem-in-c">
                <div class="title">{{newItem.title}}</div>
                <svg v-show="!newItem.isShow" class="mbBox" width="13" height="23" viewBox="0 0 13 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12.5 0H0L6.25 10L12.5 0Z" fill="#FFA09E"/>
                  <path d="M12.5 13H0L6.25 23L12.5 13Z" fill="#FFA09E"/>
                </svg>
                <!-- <div class="pcShow" v-show="true"> -->
                  <div :class="'content'" v-show="windowWidth > 768 ? true : newItem.isShow">
                    <!-- <span>Ëæ≤ÊõÜÊñ∞Âπ¥ÊúüÈñìÔºåÊàëÂÄëÁöÑÈñÄÂ∫óÊúÉÁπºÁ∫åÁáüÊ•≠Ôºå</span> -->
                    <!-- <span>‰ΩÜÁáüÊ•≠ÊôÇÈñìÂ∞áÊúâ‰ª•‰∏ãÊõ¥ÊîπÔºö ‰∏ç‰æø‰πãËôï, Êï¨Ë´ãÂéüË´í</span> -->
                    <span>{{newItem.context}}</span>
                  </div>
                  <div class="time" v-show="windowWidth > 768 ? true : newItem.isShow">
                    <!-- <span>Âπ¥‰∏âÂçÅÊôö (24/1)Ôºö11:00am ‚Äì 7:00pm</span> -->
                    <!-- <span>Âπ¥Âàù‰∏Ä„ÄÅÂàù‰∫å (25-26/1)Ôºö11:00am-6:00pm</span> -->
                    <!-- <span>Âπ¥Âàù‰∏â„ÄÅÂàùÂõõ (27-28/1)ÔºöÁÖßÂ∏∏ÁáüÊ•≠ (11:00am-9:30pm)</span> -->
                    <span>Êúâ‰ªª‰ΩïÊúâÈóúÁâôÈΩíÊó¢ÂïèÈ°åÔºüÊÑõÂ∫∑ÂÅ•Âπ´Âà∞‰Ω†ÔºÅ</span>
                  </div>
                  <div class="btn" v-show="windowWidth > 768 ? true : newItem.isShow">‰∫ÜËß£Ë©≥ÊÉÖ</div>
                </div>
              <!-- </div> -->
              <div class="newsItem-in-r">
                <span>{{newItem.day}}</span>
                <span>{{newItem.month}}</span>
              </div>
            </div>
          </div>
          <div class="newsBox-in-noData" v-if="!newsLists.length">
            Âà∞Â∫ïÂï¶~Ê≤íÊúâÊõ¥Â§öÊï∏Êìö
          </div>
        </div>
      </div>
      <div class="tidbits">
        <div class="tidbits-title">
          <div class="index_title">Ë£Ω‰ΩúËä±ÁµÆ</div>
        </div>
        <div class="tidbits-in">
          <img src="https://static.cmereye.com/imgs/2023/06/e6e8971d6925c37f.jpg" alt="" />
        </div>
      </div>
      <ContactUs />
    </div>
    <PageFooter />
    <PageNavbar />
  </div>
</template>

<style lang="scss" scoped>
  .newsPage{
    background: #fff;
    padding-bottom: 140px;
  }
  .newsBox{
    margin-top: 80px;
    &-title{
      display: flex;
      justify-content: space-between;
    }
    &-in{
      &-noData{
        height: 300px;
        line-height: 300px;
        font-size: 28px;
        text-align: center; 
        color: #ccc;
      }
    }
  }
  .newsItem{
    width: 100%;
    height: 550px;
    background: #FFF1F0;
    border-radius: 15px;
    margin-top: 76px;
    padding: 43px;
    box-sizing: border-box;
    &-in{
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: space-between;
      position: relative;
      &-l{
        width: 464px;
        height: 100%;
        background: #FFDDDA;
      }
      &-c{
        flex: 1;
        display: flex;
        flex-direction: column;
        padding-left: 25px;
        box-sizing: border-box;
        font-family: 'Arial';
        font-weight: 400;
        color: #FFA09E;
        justify-content: space-between;
        svg{
          margin: 10px auto 0;
        }
        .title{
          height: 60px;
          font-size: 3.125rem;
          line-height: 110%;
          border-left: 20px solid #FFCECB;
        }
        .content{
          font-size: 1.75rem;
          line-height: 160%;
          // margin-top: 24px;
          span{
            width: 100%;
            display: inline-block;
          }
        }
        .time{
          font-size: 1.75rem;
          line-height: 160%;
          // margin-top: 36px;
          span{
            width: 100%;
            display: inline-block;
            &::before{
              content: '';
              width: 7px;
              height: 7px;
              display: inline-block;
              background: #FFA09E;
              border-radius: 50%;
              vertical-align: middle;
              margin-top: -5px;
              margin-right: 10px;
            }
          }
        }
        .btn{
          background: #fff;
          display: inline-block;
          width: 240px;
          height: 70px;
          line-height: 70px;
          font-size: 2rem;
          color: #FFA09E;
          text-align: center;
          // margin-top: 46px;
          box-shadow: 1px 1px 4px rgba(255, 163, 158, 0.45);
          border-radius: 40px;
          cursor: pointer;
          transition: all .3s;
          &:hover{
            box-shadow: 1px 5px 10px rgba(255, 163, 158, 0.45);
          }
        }
      }
      &-r{
        width: 150px;
        height: 150px;
        background: #FFCECB;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: absolute;
        bottom: 0;
        right: 0;
        span{
          font-family: 'Arial';
          font-style: normal;
          font-weight: 700;
          font-size: 40px;
          line-height: 160%;
          text-align: center;
          color: #FFFFFF;
          width: 100px;
          display: block;
          &:first-child{
            border-bottom: 4px solid #fff;
          }
        }
      }
    }
    &:hover{
      .newsItem-in-r{
        transition: all .3s;
        box-shadow: 0px 0px 10px rgba(255, 163, 158, 0.45);
        animation: revolveAnima 10s linear infinite;
      }
    }
    &:first-child{
      margin-top: 58px;
    }
  }
  .tidbits{
    margin-top: 86.5px;
    &-title{
      display: flex;
      justify-content: center;
      align-items: center;
    }
    &-in{
      width: 100%;
      max-width: 1043px;
      margin: 58.5px auto 0;
      img{
        width: 100%;
      }
    }
  }
  @keyframes revolveAnima {
    0%{
      transform: rotate(0);
    }
    100%{
      transform: rotate(360deg);
    }
  }
  @media (min-width: 768px) and (max-width: 1452px) {
    .newsItem{
      height: calc(30vw + 60px);
      padding: 30px;
      &-in{
        &-l{
          width: 30vw;
        }
        &-c{
          .title{
            height: 50px;
            font-size: 2.5rem;
            line-height: 130%;
            border-left: 15px solid #FFCECB;
          }
          .content{
            font-size: 1.4rem;
          }
          .time{
            font-size: 1.4rem;
          }
          .btn{
            width: 30%;
            font-size: 1.5rem;
            height: 60px;
            line-height: 60px;
          }
        }
        &-r{
          width: 10vw;
          height: 10vw;
          span{
            font-size: 30px;
            width: 70%;
            &:first-child{
              border-bottom: 3px solid #fff;
            }
          }
        }
      }
    }
  }
  @media (min-width: 768px) and (max-width: 1200px) {
    .newsItem{
      height: calc(30vw + 60px);
      padding: 30px;
      &-in{
        &-l{
          width: 30vw;
        }
        &-c{
          .title{
            height: 3.5vw;
            font-size: 3vw;
            border-left: 10px solid #FFCECB;
          }
          .content{
            font-size: 1rem;
          }
          .time{
            font-size: 1rem;
          }
          .btn{
            font-size: 2vw;
            height: 5vw;
            line-height: 5vw;
          }
        }
        &-r{
          span{
            font-size: 20px;
            &:first-child{
              border-bottom: 2px solid #fff;
            }
          }
        }
      }
    }
  }
  @media (min-width: 768px) and (max-width: 1000px) {
    .newsItem{
      &-in{
        &-c{
          .title{
            font-size: 2.5vw;
          }
        }
      }
    }
  }
  @media screen and (max-width: 768px) {
    .newsPage{
      padding-bottom: 90px;
    }
    .newsBox{
      padding: 30px;
      box-sizing: border-box;
      &-title{
        flex-direction: column;
      }
    }
    .newsItem{
      padding: 24px 24px 22px;
      height: auto;
      position: all .3s;
      margin-top: 17px;
      &:first-child{
        margin-top: 0;
      }
      &-in{
        flex-direction: column;
        position: relative;
        &-l{
          width: 100%;
          img{
            width: 100%;
          }
        }
        &-c{
          width: 100%;
          text-align: center;
          padding-left: 0;
          margin-top: 60px;
          .title{
            height: auto;
            width: 120%;
            margin-left: -10%;
            font-size: 1.125rem;
            border-left: none;
          }
          .content{
            font-size: .875rem;
            text-align: left;
            margin-top: 12px;
          }
          .time{
            font-size: .875rem;
            text-align: left;
            margin-top: 12px;
            margin-left: 10px;
            span{
              display: block;
              &::before{
                content: '';
                width: 4px;
                height: 4px;
                margin-top: -4px;
                margin-left: -10px;
              }
            }
            
          }
          .btn{
            width: 158px;
            height: 46px;
            line-height: 46px;
            font-size: 1.125rem;
            margin: 20px auto 0;
          }
        }
        &-r{
          width: 26.66vw;
          height: 26.66vw;
          position: absolute;
          left: 50%;
          transform: translateX(-50%);
          top: 58vw;
          span{
            font-weight: 400;
            font-size: 2.4rem;
            width: 70px;
            line-height: 130%;
            &:last-child{
              font-size: 1.67rem;
              line-height: 160%;
            }
          }
        }
      }
      // &:hover{
      //   .newsItem-in-r{
      //     transition: all .3s;
      //     box-shadow: 0px 0px 10px rgba(255, 163, 158, 0.45);
      //     animation: revolveAnima 10s linear infinite;
      //   }
      // }
    }
    @keyframes revolveAnima {
      0%{
        transform: translateX(-50%) rotate(0);
      }
      100%{
        transform: translateX(-50%) rotate(360deg);
      }
    }
    .tidbits{
      justify-content: flex-start;
      margin-top: 60px;
      &-in{
        margin: 34px auto 0;
      }
    }
  }
</style>